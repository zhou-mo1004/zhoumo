<script>
const AMAP_KEY = "4d5f4f4b2460756568ad57f3c6e3b03c";
const statusText = document.getElementById('resultArea');

async function decideWhereToEat() {
  if (!statusText) return;

  statusText.innerHTML = '<div class="loading-wrapper"><span class="loading"></span> å®šä½ä¸­...</div>';

  try {
    const pos = await getLocation();
    const lng = pos.coords.longitude;
    const lat = pos.coords.latitude;

    statusText.innerHTML = '<div class="loading-wrapper"><span class="loading"></span> æœç´¢é™„è¿‘é¤å…...</div>';

    const res = await fetch(`https://restapi.amap.com/v3/place/around?key=${AMAP_KEY}&location=${lng},${lat}&radius=1000&types=050000&offset=20&output=json`);
    const data = await res.json();

    if (data.status !== "1" || !data.pois || data.pois.length === 0) {
      statusText.innerHTML = '<p class="status-text" style="color:#ff4400;">æœªæ‰¾åˆ°é™„è¿‘é¤å…</p >';
      return;
    }

    const r = Math.floor(Math.random() * data.pois.length);
    const shop = data.pois[r];

    // å®Œå…¨æ²¿ç”¨ä½ åŸæ¥çš„æ ·å¼ç±»åï¼Œä¸ç ´åå¸ƒå±€
    statusText.innerHTML = `
      <div class="restaurant-card">
        <h3>${shop.name}</h3>
        <p>ğŸ“ ${shop.address}</p >
        <p>ğŸ“ ${shop.tel || 'æš‚æ— ç”µè¯'}</p >
      </div>
    `;
  } catch (e) {
    statusText.innerHTML = `<p class="status-text" style="color:#ff4400;">åŠ è½½å¤±è´¥ï¼š${e.message}</p >`;
  }
}

function getLocation() {
  return new Promise((resolve, reject) => {
    if (!navigator.geolocation) {
      reject(new Error("æµè§ˆå™¨ä¸æ”¯æŒå®šä½"));
      return;
    }
    navigator.geolocation.getCurrentPosition(resolve, reject);
  });
}
</script>
